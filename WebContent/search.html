<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Cache-control" content="no-cache">
	<meta http-equiv="Expires" content="-1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>dd tool</title>
	<link href="css/bootstrap.min.css" type="text/css" rel="stylesheet" />
	<link href="css/bootstrap-table.min.css" type="text/css" rel="stylesheet" />
	<link href="css/bootstrap-editable.css" type="text/css" rel="stylesheet" />
	<link href="css/bootstrap-select.min.css" type="text/css" rel="stylesheet" />
	<link href="css/bootstrap-theme.min.css" type="text/css" rel="stylesheet" />
	<link href="css/mycss.css" type="text/css" rel="stylesheet" />

</head>
<body>

	<div class="container-fluid" style="margin-top: 10px;">

    <div class="toolbar form-inline" id="searchToolbar">
      <select class="selectpicker" id="searchSelect" multiple data-actions-box="true">
      </select>
      <button type="button" onclick="Filter()" class="btn btn-default" data-toggle="tooltip" title="Filter."><span class="glyphicon glyphicon-filter" aria-hidden="true"></span></button>
    </div>


		<table class="table table-striped fontsize" id="searchTable">

		</table>

	</div> <!-- container -->



	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/bootstrap-table.min.js"></script>
	<script src="js/bootstrap-editable.js"></script>
	<script src="js/bootstrap-table-editable.js"></script>
	<script src="js/bootstrap-select.min.js"></script>
  <script>

    var datas = [];

    var searchCols = [];
    searchCols.push({field:"tabName", title: "Table Name", sortable: true});
    searchCols.push({field:"tabType", title: "Table Type", sortable: true});
    searchCols.push({field:"tabRemarks", title: "Table Remarks", sortable: true});
    searchCols.push({field:"colName", title: "Column Name", sortable: true});
    searchCols.push({field:"colType", title: "Column Type", sortable: true});
    searchCols.push({field:"colRemarks", title: "Column Remarks", sortable: true});

    $(document)
    .ready(function() {
      buildTable($('#searchTable'), searchCols);
      ChooseTable($('#searchSelect'));
      GetSchema($('#searchTable'));
    });

    $('#searchSelect').change(function () {
        // var selectedText = $(this).find("option:selected").val();
    		// console.log(selectedText);
        // console.log($('#searchSelect').val());
    });

    function Filter(){
      var selection = $('#searchSelect').val();
      console.log(selection);

      $.each(datas, function(i, row){
        row.filtered = true;
        $.each(selection, function(j, table){
          if(row.tabName.match(table)){
            row.filtered = false;
            return false;
          }
        })
      });

      $('#searchTable').bootstrapTable("filterBy", {filtered: [false]});
      console.log(datas);

    }

    function GetSchema(table) {

        $.ajax({
            type: 'POST',
            url: "GetSchema",
            dataType: 'json',

            success: function(data) {
                console.log(data);
                table.bootstrapTable("load", data);
                datas = data;
    			  },
            error: function(data) {
                console.log(data);
            }
    		});

    }

    function buildTable($el, cols) {

        $el.bootstrapTable({
            columns: cols,
            // url: url,
            // data: data,
            toolbar: $('#searchToolbar'),
            search: true,
    				showRefresh: false,
    				showColumns: true,
    				showToggle: false,
    				pagination: false,
    				showPaginationSwitch: false,
            detailView: false
        })
    }

    function ChooseTable(table) {

    	table.empty();

        $.ajax({
            type: 'POST',
            url: "Scan",
            dataType: 'json',

            success: function(data) {
                console.log(data);
                data.sort(function(a, b) {
                  // return parseInt(b.FKCount) - parseInt(a.FKCount);
                  return parseInt(b.FKSeqCount) - parseInt(a.FKSeqCount);
                });
                tables = data;
                $.each(data, function(i, obj){
    							//console.log(obj.name);
                  var option = '<option class="fontsize" value=' + obj.name + '>' + obj.name + ' (' + obj.remarks + ') (' + obj.FKCount + ') (' + obj.FKSeqCount + ')'
                   + ' (' + obj.PKCount + ') (' + obj.PKSeqCount + ') (' + obj.RecCount + ')' + '</option>';
    							table.append(option);
                  // $('#modPKTables').append(option);
                  // table.append('<option class="fontsize" value=' + obj.name + '>' + obj.name + '</option>');
    			      });
    			      table.selectpicker('refresh');
                // $('#modPKTables').selectpicker('refresh');
    			  },
            error: function(data) {
                console.log(data);
            }
    		});

    }


  </script>

</body>
</html>
